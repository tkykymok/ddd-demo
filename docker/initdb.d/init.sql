IF NOT EXISTS(SELECT * FROM sys.databases WHERE name = 'ddd_demo')
BEGIN
    CREATE DATABASE ddd_demo;
END
GO

USE ddd_demo;
GO

IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'TASKS')
BEGIN
CREATE TABLE TASKS
(
    ID         BIGINT PRIMARY KEY IDENTITY(1,1),
    TITLE      VARCHAR(255),
    CONTENT    TEXT,
    STATUS     INT NOT NULL,
    CREATED_AT DATETIME
);
END
GO

IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'SUB_TASKS')
BEGIN
CREATE TABLE SUB_TASKS
(
    ID         BIGINT PRIMARY KEY IDENTITY(1,1),
    PARENT_ID  BIGINT,
    TITLE      VARCHAR(255),
    CONTENT    TEXT,
    STATUS     INT NOT NULL,
    CREATED_AT DATETIME,
    FOREIGN KEY (PARENT_ID) REFERENCES TASKS (ID)
);
END
GO

IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'APP_USERS')
BEGIN
CREATE TABLE APP_USERS
(
    ID    BIGINT PRIMARY KEY IDENTITY(1,1),
    NAME  VARCHAR(255),
    EMAIL VARCHAR(255)
);
END
GO

IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'PRODUCTS')
BEGIN
CREATE TABLE PRODUCTS
(
    ID    BIGINT PRIMARY KEY IDENTITY(1,1),
    NAME  VARCHAR(255),
    PRICE DECIMAL
);
END
GO

IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'ORDERS')
BEGIN
CREATE TABLE ORDERS
(
    ID           BIGINT PRIMARY KEY IDENTITY(1,1),
    USER_ID      BIGINT,
    ORDER_DATE   DATE,
    TOTAL_AMOUNT DECIMAL,
    VERSION      BIGINT,
    FOREIGN KEY (USER_ID) REFERENCES APP_USERS (ID)
);
END
GO

IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'ORDER_ITEMS')
BEGIN
CREATE TABLE ORDER_ITEMS
(
    ID               BIGINT PRIMARY KEY IDENTITY(1,1),
    ORDER_ID         BIGINT,
    SEQ_NO           INT,
    PRODUCT_ID       BIGINT,
    QUANTITY         INT,
    SUB_TOTAL_AMOUNT DECIMAL,
    FOREIGN KEY (ORDER_ID) REFERENCES ORDERS (ID),
    FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS (ID)
);
END
GO

INSERT INTO TASKS (ID, TITLE, CONTENT, STATUS, CREATED_AT)
VALUES (1, '親タスク1', '親タスクの内容1', 0, CURRENT_TIMESTAMP),
       (2, '親タスク2', '親タスクの内容2', 1, CURRENT_TIMESTAMP);

INSERT INTO SUB_TASKS (ID, PARENT_ID, TITLE, CONTENT, STATUS, CREATED_AT)
VALUES (101, 1, '子タスク1-1', '子タスクの内容1-1', 0, CURRENT_TIMESTAMP),
       (102, 1, '子タスク1-2', '子タスクの内容1-2', 2, CURRENT_TIMESTAMP),
       (201, 2, '子タスク2-1', '子タスクの内容2-1', 0, CURRENT_TIMESTAMP);

INSERT INTO APP_USERS (ID, NAME, EMAIL)
VALUES (1, 'John Doe', 'john.doe@example.com'),
       (2, 'Jane Smith', 'jane.smith@example.com');

INSERT INTO ORDERS (USER_ID, ORDER_DATE, TOTAL_AMOUNT, VERSION)
VALUES (1, '2023-01-01', 2000.00, 0),
       (2, '2023-01-02', 1500.00, 0);

INSERT INTO PRODUCTS (ID, NAME, PRICE)
VALUES (1, '商品A', 500.00),
       (2, '商品B', 1000.00),
       (3, '商品C', 1500.00);

INSERT INTO ORDER_ITEMS (ORDER_ID, SEQ_NO, PRODUCT_ID, QUANTITY, SUB_TOTAL_AMOUNT)
VALUES (1, 1, 1, 2, 1000.00),
       (1, 2, 2, 1, 1000.00),
       (2, 3, 3, 1, 1500.00);